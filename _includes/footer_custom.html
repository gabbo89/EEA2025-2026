{%- if site.footer_content -%}
  <p class="text-small text-grey-dk-100 mb-0">{{ site.footer_content }}</p>
{%- endif -%}


{% if page.usetocbot %} 
    <!-- tocbot is an awesome table of contents generator, see: https://tscanlin.github.io/tocbot/ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.11.1/tocbot.min.js"></script>

    <script>
      /* Dynamically add the toc navbar after the side-bar element. This allows us
         to *not* have to override default.html in _layouts */
      let sideBarElements = document.getElementsByClassName('side-bar');
      let tocNav = document.createElement('nav');
      tocNav.setAttribute("id", "tocbot-toc");
      tocNav.classList.add("js-toc");
      tocNav.classList.add("tocbot-right");
      /* Insert after the side-bar when present; otherwise append to body as a fallback */
      if (sideBarElements.length > 0){
        sideBarElements[0].after(tocNav);
      } else {
        document.body.appendChild(tocNav);
      }

      /** WARNING: YOU MUST USE C MULTI-LINE COMMENT STYLE RATHER THAN // BECAUSE 
       *  OF HOW JEKYLL COMPILES THIS FILE INTO SINGLE LINES **/
      tocbot.init({
        /* Where to render the table of contents. */
        tocSelector: '.js-toc',
        /* Where to grab the headings to build the table of contents. */
        contentSelector: '.main-content',
        /* How many heading levels should collapse. Default is 0 */
        collapseDepth: 2,
        /* Which headings to grab inside of the contentSelector element. */
        headingSelector: 'h1, h2, h3, h4',
      });

      /* Track scrolling to show/hide the tocbot navigation bar on right side */
      var onScrollHandler = function (event) {

        /* End event listener after visitor scrolls past 500px */
        if (window.pageYOffset > 500) {
          window.removeEventListener('scroll', onScrollHandler, false);
          document.getElementById("tocbot-toc").style.visibility = "visible";
        }
        /* console.log("window scroll event:", window.pageYOffset); */
      };

      /* Listen for scroll events */
      window.addEventListener('scroll', onScrollHandler, false);

      /*
       * Position the TOC to the right of the main content column so it
       * never overlaps the left side-bar or the main column. This computes
       * the main-content bounding rect and places the TOC with a small gap.
       */
      function adjustTocPosition(){
        try {
          var toc = document.getElementById('tocbot-toc');
          var mainContent = document.querySelector('.main-content');
          if (!toc || !mainContent) return;

          /* Hide on narrow viewports (matches the CSS rule in custom.css) */
          if (window.innerWidth < 1000) {
            toc.style.display = 'none';
            return;
          } else {
            toc.style.display = '';
          }

          var rect = mainContent.getBoundingClientRect();
          /* place TOC 16px to the right of the main content */
          /* Anchor the TOC to the viewport right side to avoid complex left
           * calculations that can accidentally place it over content. Use
           * a small right offset so it stays visible and doesn't affect layout. */
          toc.style.position = 'fixed';
          toc.style.right = '2rem';
          toc.style.left = 'auto';
          toc.style.right = 'auto';
          toc.style.top = (Math.max(80, rect.top + 10)) + 'px';
          toc.style.visibility = toc.style.visibility || 'visible';
          toc.style.zIndex = 1000;
        } catch (e) {
          /* fail silently */
        }
      }

      /* adjust on load and resize */
      window.addEventListener('load', adjustTocPosition, false);
      window.addEventListener('resize', adjustTocPosition, false);
      /* also run shortly after init in case layout shifts */
      setTimeout(adjustTocPosition, 250);

      /* Remove numeric prefixes from TOC entries (e.g. "1. a. Title") so
       * the TOC doesn't duplicate numbering that is already present in
       * heading text. This strips repeated leading groups like "1. a. " */
      function stripTocNumbers(){
        try {
          var toc = document.getElementById('tocbot-toc');
          if (!toc) return;
          var links = toc.querySelectorAll('a');
          links.forEach(function(a){
            var txt = (a.textContent || '').trim();
            /* Remove multiple leading numeric or alpha groups like "1. a. " */
            var cleaned = txt.replace(/^\s*(?:(?:\d+|[a-zA-Z])\.\s*)+/, '');
            /* If there are inner span elements (toc numbering), replace innerHTML
             * with the cleaned text to remove them entirely. */
            if (cleaned !== txt) a.innerHTML = cleaned;
          });
        } catch (e) { /* silent */ }
      }

      window.addEventListener('load', stripTocNumbers, false);
      window.addEventListener('resize', function(){ setTimeout(stripTocNumbers, 100); }, false);
      setTimeout(stripTocNumbers, 350);

      /*
       * Ensure the main column margin-left matches the side-bar width so the
       * main content never overlaps the fixed sidebar. This mirrors the
       * theme behavior but defends against cases where styles are different
       * or the DOM is modified dynamically.
       */
      function adjustMainMargin(){
        try {
          var sidebar = document.querySelector('.side-bar');
          var main = document.querySelector('.main');
          if (!sidebar || !main) return;

          /* Only apply on wide viewports where sidebar is fixed */
          if (window.innerWidth < 800) {
            main.style.marginLeft = '';
            return;
          }

          var sidebarRect = sidebar.getBoundingClientRect();
          var sidebarWidth = Math.ceil(sidebarRect.width);
          /* add small gap of 16px to separate columns */
          var target = sidebarWidth + 16;
          main.style.marginLeft = target + 'px';
        } catch (e) {
          /* silent */
        }
      }

      window.addEventListener('load', adjustMainMargin, false);
      window.addEventListener('resize', adjustMainMargin, false);
      setTimeout(adjustMainMargin, 150);
    </script>
  {% endif %}